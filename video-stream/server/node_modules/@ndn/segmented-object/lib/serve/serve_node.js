import { Endpoint } from "@ndn/endpoint";
import { Name } from "@ndn/packet";
import { DataProducer } from "./data-producer_node.js";
/**
 * Start serving an segmented object.
 * @param prefixInput Data prefix excluding segment number.
 * @param source where to read segment payload chunks.
 * @param opts other options.
 */
export function serve(prefixInput, source, opts = {}) {
    const prefix = new Name(prefixInput);
    const { endpoint = new Endpoint() } = opts;
    const producer = DataProducer.create(source, prefix, opts);
    const prod = endpoint.produce(opts.producerPrefix ?? prefix, producer.processInterest, {
        concurrency: 16,
        describe: opts.describe ?? `serve(${prefix})`,
        announcement: opts.announcement,
    });
    return {
        prefix,
        processInterest(interest) {
            return prod.processInterest(interest);
        },
        close() {
            producer.close();
            prod.close();
        },
    };
}
