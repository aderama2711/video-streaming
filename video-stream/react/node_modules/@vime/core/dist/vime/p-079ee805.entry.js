import{r as t,c as s,h as i,g as e}from"./p-14922b2a.js";import{c as n,p as h}from"./p-9513562e.js";import{c as a,h as r,e as o,x as c}from"./p-c79db6f4.js";import{L as d}from"./p-c2c6b779.js";import"./p-7af283a3.js";let m=0;const l=new Set,u=class{constructor(i){t(this,i),this.vmEmbedSrcChange=s(this,"vmEmbedSrcChange",3),this.vmEmbedMessage=s(this,"vmEmbedMessage",3),this.vmEmbedLoaded=s(this,"vmEmbedLoaded",3),this.srcWithParams="",this.hasEnteredViewport=!1,this.embedSrc="",this.mediaTitle="",this.params="",this.preconnections=[],a(this)}onEmbedSrcChange(){this.srcWithParams=r(this.embedSrc)&&this.embedSrc.length>0?n(this.embedSrc,this.params):void 0}srcWithParamsChange(){o(this.srcWithParams)||this.hasEnteredViewport||l.has(this.embedSrc)||h(this.srcWithParams)&&l.add(this.embedSrc),this.vmEmbedSrcChange.emit(this.srcWithParams)}preconnectionsChange(){this.hasEnteredViewport||this.preconnections.filter((t=>!l.has(t))).forEach((t=>{h(t)&&l.add(t)}))}connectedCallback(){this.lazyLoader=new d(this.host,["data-src"],(t=>{const s=t.getAttribute("data-src");t.removeAttribute("src"),c(s)||t.setAttribute("src",s)})),this.onEmbedSrcChange(),this.genIframeId()}disconnectedCallback(){this.lazyLoader.destroy()}onWindowMessage(t){var s,i,e;if(t.source!==(null===(s=this.iframe)||void 0===s?void 0:s.contentWindow)||r(this.origin)&&this.origin!==t.origin)return;const n=null!==(e=null===(i=this.decoder)||void 0===i?void 0:i.call(this,t.data))&&void 0!==e?e:t.data;n&&this.vmEmbedMessage.emit(n)}postMessage(t,s){var i,e,n,h,a,r;return n=this,h=void 0,r=function*(){null===(e=null===(i=this.iframe)||void 0===i?void 0:i.contentWindow)||void 0===e||e.postMessage(JSON.stringify(t),null!=s?s:"*")},new((a=void 0)||(a=Promise))((function(t,s){function i(t){try{o(r.next(t))}catch(t){s(t)}}function e(t){try{o(r.throw(t))}catch(t){s(t)}}function o(s){var n;s.done?t(s.value):(n=s.value,n instanceof a?n:new a((function(t){t(n)}))).then(i,e)}o((r=r.apply(n,h||[])).next())}))}onLoad(){this.vmEmbedLoaded.emit()}genIframeId(){m+=1,this.id=`vm-iframe-${m}`}render(){return i("iframe",{id:this.id,class:"lazy",title:this.mediaTitle,"data-src":this.srcWithParams,allowFullScreen:!0,allow:"autoplay; encrypted-media; picture-in-picture;",onLoad:this.onLoad.bind(this),ref:t=>{this.iframe=t}})}get host(){return e(this)}static get watchers(){return{embedSrc:["onEmbedSrcChange"],params:["onEmbedSrcChange"],srcWithParams:["srcWithParamsChange"],preconnections:["preconnectionsChange"]}}};u.style=":host{z-index:var(--vm-media-z-index)}iframe{position:absolute;top:0;left:0;border:0;width:100%;height:100%;user-select:none}";export{u as vm_embed}